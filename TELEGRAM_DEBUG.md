# üîç –û—Ç–ª–∞–¥–∫–∞ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üöÄ –î–µ–ø–ª–æ–π —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏:

```bash
cd ~/webapptraining
git pull origin main
npm run build
pm2 restart all
```

---

## üì± –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Telegram

### 1. –û—Ç–∫—Ä–æ–π —á–µ—Ä–µ–∑ Telegram Desktop –∏–ª–∏ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ù–∞–π–¥–∏ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞
- –ù–∞–∂–º–∏ –Ω–∞ —Å–∏–Ω—é—é –∫–Ω–æ–ø–∫—É Web App (–∏–ª–∏ –∫–æ–º–∞–Ω–¥—É `/start`)

### 2. –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

#### –í Telegram Desktop (Windows/Mac/Linux):
1. –û—Ç–∫—Ä–æ–π Web App
2. –ù–∞–∂–º–∏ `Ctrl+Shift+I` (–∏–ª–∏ `Cmd+Option+I` –Ω–∞ Mac)
3. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Console

#### –í –º–æ–±–∏–ª—å–Ω–æ–º Telegram (Android):
1. –í–∫–ª—é—á–∏ USB debugging
2. –ü–æ–¥–∫–ª—é—á–∏ –∫ –∫–æ–º–ø—å—é—Ç–µ—Ä—É
3. –û—Ç–∫—Ä–æ–π `chrome://inspect` –≤ Chrome
4. –ù–∞–π–¥–∏ WebView Telegram

---

## üîé –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

–ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è Web App –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
‚úÖ Telegram Web App SDK loaded
üì± Telegram user: {id: 123456, first_name: "–ò–ª—å—è", ...}
üîç Telegram WebApp: {...}
üîç initData: "query_id=..."
üîç initDataUnsafe: {...}
‚úÖ Telegram Web App detected, authenticating...
üì° Response status: 200
‚úÖ Auth successful: {id: "tg-123456", ...}
```

### ‚ùå –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫–∏:

**`‚ÑπÔ∏è Not running in Telegram Web App`**
- Web App SDK –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å —á–µ—Ä–µ–∑ Telegram, –∞ –Ω–µ –±—Ä–∞—É–∑–µ—Ä

**`‚ùå Auth failed: {error: "..."}`**
- –û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ PM2 (—Å–º. –Ω–∏–∂–µ)

**`‚ùå Auth error: ...`**
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —Å–µ—Ä–≤–µ—Ä—É
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω

---

## üìã –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ (PM2)

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏:

```bash
# –õ–æ–≥–∏ backend (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —ç–º–æ–¥–∑–∏)
pm2 logs nubo-training-backend --lines 50
```

### ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:

```
üîç Telegram auth request received
üì¶ initData length: 543
üì¶ initData (first 200 chars): query_id=AAHdF6IQAAAAAN0Xo...
‚úÖ Telegram initData validation passed
üë§ User param: {"id":123456,"first_name":"–ò–ª—å—è",...
‚úÖ Parsed Telegram user: { id: 123456, first_name: '–ò–ª—å—è', username: 'ilyagerz' }
‚úÖ User created: tg-123456
```

### ‚ùå –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞:

```
üîç Telegram auth request received
üì¶ initData length: 543
‚ö†Ô∏è Telegram initData validation failed, but continuing...
‚úÖ Parsed Telegram user: ...
```

–≠—Ç–æ **–Ω–æ—Ä–º–∞–ª—å–Ω–æ** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

---

## ‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ Web App –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ BotFather:

```
/mybots ‚Üí –í—ã–±–µ—Ä–∏ –±–æ—Ç–∞ ‚Üí Bot Settings ‚Üí Menu Button ‚Üí Configure Menu Button
```

URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: `https://training.nubofit.ru`

### 2. –ü—Ä–æ–≤–µ—Ä—å `.env.local` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cat ~/webapptraining/.env.local | grep TELEGRAM
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
TELEGRAM_BOT_TOKEN=8187775383:AAG6r4d_S7pOjt8UcTQzPnuNwvacriPR-B4
TELEGRAM_BOT_USERNAME=your_bot_username
```

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
**–ü—Ä–∏—á–∏–Ω–∞:** initData –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `user`  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç initData –≤ –ª–æ–≥–∞—Ö backend

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
**–ü—Ä–∏—á–∏–Ω–∞:** –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth` –≤–º–µ—Å—Ç–æ `/dashboard`  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –±—Ä–∞—É–∑–µ—Ä–∞, —É–±–µ–¥–∏—Å—å —á—Ç–æ `setUser()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –§–æ—Ç–æ –Ω–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω–∞:** Telegram –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç `photo_url` –∏–ª–∏ –æ–Ω–æ –ø—É—Å—Ç–æ–µ  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å `telegramUser.photo_url` –≤ –ª–æ–≥–∞—Ö backend

---

## üìù –ü–æ—Å–ª–µ –æ—Ç–ª–∞–¥–∫–∏

–ö–æ–≥–¥–∞ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∫–æ–ø–∏—Ä—É–π —Å—é–¥–∞:
1. ‚úÖ –ß—Ç–æ –±—ã–ª–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
2. ‚úÖ –ß—Ç–æ –±—ã–ª–æ –≤ –ª–æ–≥–∞—Ö PM2
3. ‚úÖ –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –±—ã–ª–∏ (–µ—Å–ª–∏ –±—ã–ª–∏)

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å –ø—Ä–æ–±–ª–µ–º—É!

---

## üîß –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

# 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
cd ~/webapptraining && git pull && npm run build && pm2 restart all

# 2. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
pm2 logs --lines 100

# 3. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ª—å–∫–æ backend
pm2 logs nubo-training-backend --lines 50

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ
pm2 restart all

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status
```

